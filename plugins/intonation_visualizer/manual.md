### **语调可视化插件 - 用户手册**

欢迎使用新版语调可视化插件！本手册将引导您了解如何使用这款强大的工具来加载、对比、分析语调数据。新版本引入了**图层系统**和**全局分组**，让多曲线对比分析变得前所未有的灵活和直观。

#### **1. 功能概述**

本插件旨在解决语调分析中的核心痛点，提供以下主要功能：

*   **多图层管理**: 同时加载和管理多条语调曲线（称为“图层”），不再局限于单条分析。
*   **拖拽加载**: 支持直接从桌面或文件夹拖拽 `.csv` 或 `.xlsx` 文件到窗口中，极大提升效率。
*   **全局分组**: 将来自不同图层的曲线依据**共同的标签**（例如“疑问句”）进行分组，并统一设置样式。
*   **分组建模**: 自动计算并可视化每个**全局分组**的**平均语调轮廓**，帮助您发现不同语类的典型语调模式。
*   **强大的可视化控制**:
    *   **全局控制**: 统一设置图表样式、F0归一化方法。
    *   **图层级控制**: 为每个图层独立设置数据点显示、曲线平滑度。
*   **交互式图表**: 支持平移（鼠标左键拖拽）和缩放（Ctrl + 鼠标滚轮）视图，让您能聚焦于任何细节。
*   **集成与独立运行**: 既可以从主程序的“音频分析”模块接收数据，也可以独立运行并加载外部数据文件。

#### **2. 快速上手**

您可以通过以下两种方式将语调数据加载到插件中。

##### **从主程序加载 (推荐)**

1.  在主程序的 `资源管理 -> 音频分析` 模块中，加载一个音频文件并运行F0分析。
2.  在语谱图上用鼠标左键拖拽出一个**选区**。
3.  在选区内**右键单击**，从弹出的菜单中选择 **“发送到语调可视化器...”**。
4.  插件窗口将自动弹出，并加载该选区的语调数据作为一个新的**图层**。

##### **从文件加载（拖拽或菜单）**

这是加载已有数据的最常用方法。

*   **方法一：拖拽加载（最便捷）**
    1.  打开您的文件管理器。
    2.  **直接将一个或多个** `.csv` 或 `.xlsx` 文件拖拽到插件窗口的 **任意位置**。
    3.  松开鼠标，每个文件中的数据都将被加载为一个新的**图层**。

*   **方法二：使用菜单**
    1.  在图表区域**右键点击**，弹出功能菜单。
    2.  选择 **“从文件加载数据...”**。
    3.  在弹出的对话框中，选择您想要分析的 `.csv` 或 `.xlsx` 文件。

#### **3. 界面详解**

插件界面分为三个主要部分：左侧面板、中央图表区域和右侧面板。

##### **左侧面板：图层管理器**

这里是您管理所有数据图层的地方。表格中的每一行都代表一条独立的语调曲线。

| 列名 | 功能 |
| :--- | :--- |
| **颜色** | 🎨 彩色方块，**点击**可从弹出的调色板中为该**图层**选择一个基础颜色。 |
| **图层名称** | 📝 显示图层名称。**双击**可打开**配置窗口**；**右键**可进行更多操作。图标 ✅ 表示可见，🚫 表示隐藏。 |
| **分组依据** | 🏷️ 显示该图层用于分组的依据。可以是数据中的一列（如`vowel`），也可以是您手动输入的标签（如`疑问句`）。**双击**可编辑。 |

*   **添加新图层...**: 点击此按钮打开**配置窗口**，加载并设置一个新的数据图层。
*   **更新图表**: 点击此按钮，根据当前所有设置重新绘制图表。

**右键菜单操作**:
*   **显示/隐藏图层**: 切换当前图层在图表中的可见性。
*   **重命名...**: 直接在表格中编辑图层名称。
*   **配置...**: 打开**配置窗口**，修改该图层的数据文件、列映射等。
*   **移除图层**: 从列表中永久删除该图层。

##### **中央面板：图表区域**

这是可视化的核心区域。

*   **平移**: 按住 **鼠标左键** 在图表上拖拽，可以平移视图。
*   **缩放**: 将鼠标指针悬停在您想缩放的中心点，按住 **`Ctrl`** 键并 **滚动鼠标滚轮**。
*   **右键菜单**: 在图表上右键点击，可以访问快捷功能，如 **刷新图表**、**重置视图**、**保存图片** 等。
*   **悬浮提示**: 当鼠标悬停在曲线上时，会显示该点的详细信息（图层名、分组名、时间、F0值）。

##### **右侧面板：样式与分析**

这里提供对图表外观和高级分析功能的控制。

*   **全局设置 (Global Settings)**
    *   **标题/X轴/Y轴**: 自定义图表的主标题和坐标轴标签。
    *   **时间归一化**: **[核心功能]** 勾选后，所有曲线的时间轴都会被缩放到0-100%的相对时间。**这是进行有效语调模式对比和计算平均轮廓的前提。**
    *   **F0归一化**: 选择对F0（基频）值的变换方式，用于消除个体音高差异，便于对比（如半音、Z-Score）。

*   **图层设置 (Layer Settings)**
    *   此面板**仅在您选中左侧某个图层时**可用。
    *   **曲线平滑**: 独立控制**当前选中图层**的曲线平滑度。
    *   **显示选项**: 独立控制**当前选中图层**是否显示原始数据点及其样式。

*   **全局分组样式 (Global Grouping Style)**
    *   **颜色方案**: 为所有**全局分组**选择一个预设的颜色主题，并点击“应用”。
    *   **分组列表**: 程序会自动扫描所有**可见图层**的分组标签，并在此处列出。您可以：
        *   ✅ **勾选/取消勾选**来显示或隐藏某个分组的所有曲线。
        *   🎨 **点击颜色方块**来为某个分组的所有曲线指定统一的颜色。
    *   **显示分组平均轮廓**: **[核心功能]** 勾选后，插件会为**每个可见的全局分组**计算一条平均语调轮廓线（通常以加粗虚线表示），直观展示该组的典型语调模式。
        *   **注意**: 此功能仅在 **“时间归一化”** 被勾选时可用。

#### **4. 核心工作流程：对比不同句式的平均语调模式**

1.  **加载数据**: 将多组数据文件（例如3个疑问句，3个陈述句）拖拽加载到插件中。此时左侧列表会出现6个图层。
2.  **分配分组**: 在左侧**图层管理器**表格中，双击每个图层的“分组依据”列，为3个疑问句图层输入“疑问句”，为另外3个输入“陈述句”。
3.  **统一颜色**: 在右侧**全局分组样式**面板中，您会看到“疑问句”和“陈述句”两个条目。点击它们旁边的颜色方块，为它们分配合适的颜色（例如疑问句用蓝色，陈述句用红色）。
4.  **时间归一化**: 在右侧**全局设置**中，勾选 **“时间归一化”**。
5.  **计算平均轮廓**: 在右侧**全局分组样式**面板中，勾选 **“显示分组平均轮廓”**。
6.  **观察结果**: 图表中会显示所有6条原始曲线，同时还会出现两条加粗的虚线：一条蓝色的代表“疑问句”的平均语调模式，一条红色的代表“陈述句”的平均语调模式。

#### **5. 支持的文件格式**

插件支持标准的 `.csv` 和 `.xlsx` (Excel) 格式。文件内容需要至少包含两列数值型数据，分别代表**时间**和**F0(基频)**。插件会自动识别列名中包含 `time` 和 `f0` (不区分大小写) 的列。