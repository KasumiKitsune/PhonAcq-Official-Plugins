# 语调可视化与建模插件 - 用户手册

欢迎使用语调可视化与建模插件！本手册将引导您了解如何使用这款强大的工具来加载、对比、分析和建模语音的语调数据。

## 1. 功能概述

本插件旨在解决语调分析中的核心痛点，提供以下主要功能：

*   **多数据源管理**: 同时加载和管理多条语调曲线，不再局限于单条分析。
*   **拖拽加载**: 支持直接从桌面或文件夹拖拽 `.csv` 或 `.xlsx` 文件到窗口中，极大提升效率。
*   **分组对比**: 将不同的语调曲线自由分组（例如，按“疑问句”、“陈述句”），并能筛选显示特定分组。
*   **语调建模**: 自动计算并可视化每个分组的 **平均语调轮廓**，帮助您发现不同语类的典型语调模式。
*   **强大的可视化控制**: 自由定制图表样式、数据点显示、F0归一化方法和曲线平滑度。
*   **交互式图表**: 支持平移（鼠标左键拖拽）和缩放（Ctrl + 鼠标滚轮）视图，让您能聚焦于任何细节。
*   **集成与独立运行**: 既可以从主程序的“音频分析”模块接收数据，也可以独立运行并加载外部数据文件。

## 2. 快速上手

您可以通过以下两种方式将语调数据加载到插件中。

### 从主程序加载 (推荐)

1.  在主程序的 `资源管理 -> 音频分析` 模块中，加载一个音频文件并运行F0分析。
2.  在语谱图上用鼠标左键拖拽出一个**选区**。
3.  在选区内**右键单击**，从弹出的菜单中选择 **“发送到语调可视化器...”**。
4.  插件窗口将自动弹出，并加载该选区的语调数据作为一条新的曲线。

### 从文件加载（拖拽或菜单）

这是加载已有数据的最常用方法。

#### 方法一：拖拽加载（最便捷）

1.  打开您的文件管理器。
2.  **直接将一个或多个** `.csv` 或 `.xlsx` 文件拖拽到插件窗口的 **任意位置**。
3.  松开鼠标，文件中的数据将自动被加载为新的语调曲线。

#### 方法二：使用菜单

1.  在图表区域**右键点击**，弹出功能菜单。
2.  选择 **“从文件加载数据...”**。
3.  在弹出的对话框中，选择您想要分析的 `.csv` 或 `.xlsx` 文件。

## 3. 界面详解

插件界面分为三个主要部分：左侧面板、中央图表区域和右侧面板。

### 左侧面板：数据与处理

这里是您管理数据源和进行全局数据预处理的地方。

#### **数据源管理 (Data Source Management)**

这是一个表格，列出了所有已加载的语调曲线。

| 列名   | 功能                                                                                             |
| :----- | :----------------------------------------------------------------------------------------------- |
| **可见** | ✅ 复选框，控制该条曲线是否在图表中显示。                                                         |
| **颜色** | 🎨 彩色方块，**点击**可从弹出的调色板中为该曲线选择一个新颜色。                                    |
| **名称** | 📝 可编辑。**双击**可重命名该曲线，便于在图例中识别。                                               |
| **分组** | 🏷️ 可编辑。**双击**可为曲线分配一个组名（如“疑问句”）。这是进行分组建模的基础。                   |
| **删除** | 🗑️ 点击按钮可从列表中永久删除该条曲线。                                                           |

#### **全局数据处理 (Global Data Processing)**

*   **F0归一化**: 选择对F0（基频）值的变换方式，用于消除个体音高差异，便于对比。
    *   **原始值 (Hz)**: 不做任何处理。
    *   **半音 (Semitone)**: 将F0转换为对数尺度的半音值，更符合人耳对音高的感知。
    *   **Z-Score**: 对F0进行标准化（减去均值，除以标准差），最彻底地消除绝对音高差异。
*   **曲线平滑**: 通过移动平均算法平滑语调曲线，去除微小的抖动，观察宏观趋势。您可以通过滑块调整平滑窗口的大小。

### 中央面板：图表区域

这是可视化的核心区域。

*   **平移**: 按住 **鼠标左键** 在图表上拖拽，可以平移视图。
*   **缩放**: 将鼠标指针悬停在您想缩放的中心点，按住 **`Ctrl`** 键并 **滚动鼠标滚轮**。
*   **右键菜单**: 在图表上右键点击，可以访问快捷功能，如 **刷新图表**、**重置视图**、**保存图片** 等。
*   **悬浮提示**: 当鼠标悬停在数据点上时，会显示该点的详细信息。

### 右侧面板：显示与建模

这里提供对图表外观和高级分析功能的控制。

#### **图表样式 (Chart Style)**

*   **标题/X轴/Y轴**: 自定义图表的主标题和坐标轴标签。
*   **时间归一化 (0-100%)**: **[核心功能]** 勾选后，所有曲线的时间轴都会被缩放到0-100%的相对时间。**这是进行有效语调模式对比和计算平均轮廓的前提。**
*   **显示图例**: 控制是否显示图表右上角的图例。

#### **显示选项 (Display Options)**

*   **显示数据点**: 在平滑的曲线上方，额外显示原始的、未平滑的F0数据点。
*   **点大小/点透明度**: 调整数据点的大小和透明度。

#### **分组对比与建模 (Group Comparison & Modeling)**

*   **分组筛选**: 从下拉列表中选择一个分组，图表将只显示属于该分组的曲线。
*   **显示分组平均轮廓**: **[核心功能]** 勾选后，插件会为图表中当前显示的每个分组计算一条平均语调轮廓线（通常以加粗虚线表示），直观展示该组的典型语调模式。
    *   **注意**: 此功能仅在 **“时间归一化”** 被勾选时可用。

## 4. 核心工作流程

### 场景一：对比两个句子的语调

1.  通过拖拽或菜单，加载两个数据文件，例如 `statement.csv` 和 `question.csv`。
2.  在左侧的 **数据源管理** 表格中，为它们分配合适的 **名称** 和 **颜色**。
3.  在右侧面板，勾选 **“时间归一化”**，以消除句子时长差异带来的影响。
4.  现在，您可以直观地在图表上对比两条语调曲线的形态差异。

### 场景二：分析不同句式（如疑问句 vs 陈述句）的平均语调模式

1.  准备好多组数据文件，例如3个疑问句文件和3个陈述句文件。
2.  将所有6个文件拖拽加载到插件中。
3.  在左侧 **数据源管理** 表格中，将3个疑问句的 **分组** 都修改为“疑问句”，将另外3个的 **分组** 都修改为“陈述句”。可以为不同分组设置不同的色系。
4.  在右侧面板，确保 **“时间归一化”** 已被勾选。
5.  勾选 **“显示分组平均轮廓”**。
6.  **观察结果**: 图表中会显示所有6条原始曲线，同时还会出现两条加粗的虚线，分别代表“疑问句”和“陈述句”的平均语调模式。您甚至可以使用 **“分组筛选”** 下拉框单独查看某一类句式的内部差异及其平均模式。

## 5. 支持的文件格式

插件支持标准的 `.csv` 和 `.xlsx` (Excel) 格式。文件内容需要至少包含两列：一列是 **时间**，另一列是 **F0(基频)**。

插件会自动识别列名中包含 `time` 和 `f0` (不区分大小写) 的列。

## 6. 常见问题 (FAQ)

*   **问：为什么我勾选了“显示分组平均轮廓”，但没有任何反应？**
    *   **答：** 请确保您同时勾选了右侧面板的 **“时间归一化”** 复选框。计算有意义的平均轮廓必须在相对时间轴上进行。

*   **问：图表中的中文标签显示为方块□□□怎么办？**
    *   **答：** 插件已内置了中文字体查找功能。如果仍然出现问题，说明您的系统中可能缺少常用的中文字体（如微软雅黑, 思源黑体等）。

*   **问：我不小心把图表拖拽/缩放得找不到了，怎么办？**
    *   **答：** 在图表区域 **右键点击**，选择 **“重置视图”** 即可恢复到默认的显示范围。

*   **问：如何将分析结果保存下来？**
    *   **答：** 在图表区域 **右键点击**，选择 **“保存图片...”** 或 **“复制图片”**。前者可以将图表保存为PNG等格式，后者可以将其复制到剪贴板，直接粘贴到报告或文档中。