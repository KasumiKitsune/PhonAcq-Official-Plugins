# 插件手册：TTS 批量分割与命名器

## 1. 欢迎使用

欢迎使用 **TTS 批量分割与命名器**！本插件是一款强大的效率工具，旨在将一个包含多个词语或短语的**长音频文件**，根据您提供的**词表**，自动、快速地分割成一个个独立的、已命名的音频文件。

它尤其适用于为语音合成（TTS）、语音识别（ASR）或声学实验准备和切分语音材料的场景。

![TTS Splitter Plugin Banner](images/splitter_banner.png)  
*(图1: 插件主界面概览)*

---

## 2. 核心功能与工作流

本插件遵循一个简单直观的四步工作流：**加载 -> 配置 -> 预览 -> 处理**。

### 第一步：加载文件

您需要提供两个关键文件：

-   **长音频文件**: 一个 `.wav` 或 `.mp3` 文件，其中包含了您**按顺序**朗读的所有词条。每个词条之间应有自然的静音停顿。
-   **词表文件**: 一个与音频内容**顺序完全对应**的标准 `.json` 词表文件。插件将使用此文件中的单词来为分割出的音频片段命名。

**操作方法**:
1.  点击 **[选择长音频文件...]** 按钮，选择您的录音。
2.  点击 **[选择对应的词表...]** 按钮，选择您的 `.json` 词表。

> **快捷提示**: 您也可以在“通用词表编辑器”中，右键点击一个词表文件，选择 **[发送到批量分割器]**，插件将自动加载该词表。

---

### 第二步：配置分割参数

这是本插件的核心。通过调整参数，您可以精确地控制音频的分割方式。所有参数的调整都会**实时反映**在右侧的预览区。

![分割参数](images/splitter_params.png)  
*(图2: 分割参数配置区域)*

-   **分割模式**:
    -   **精确模式**: 算法会尝试精确地切分出每个单词的发音部分，可能会去除词首和词尾非常微弱的气流声。适用于对分割精度要求较高的场景。
    -   **完整模式 (推荐)**: 算法会以相邻两个单词之间的**静音段中心**作为分割点。这种模式能最大程度地保证每个单词（包括其微弱的起止音）的完整性，是制作TTS语音包时的**首选模式**。

-   **静音阈值 (dB)**:
    -   这是一个决定“多大的声音才不被当做静音”的滑块。
    -   **向左滑动 (数值更小)**: 判断更严格，即使是非常微弱的声音也会被识别，可能导致分割出的片段较少。
    -   **向右滑动 (数值更大)**: 判断更宽松，微弱的背景噪音或气流声可能被忽略，可能导致分割出的片段较多。

-   **最小静音时长 (ms)**:
    -   只有当一段静音的持续时间超过此值（毫秒）时，它才会被认为是一个有效的词间停顿。
    -   如果您的语速很快，停顿很短，可以适当**减小**此值。
    -   如果您的录音中有很多正常的词内停顿（如长单词内部），可以适当**增大**此值以避免错误分割。

-   **分割点偏移 (ms)**:
    -   在确定分割点后，对切点位置进行的微调。
    -   **正值**: 将切点向外扩张，为每个音频片段的开头和结尾保留更多的空白。
    -   **负值**: 将切点向内收缩，使分割更紧凑。

> **智能推荐**: 如果您不确定如何设置参数，请先加载好音频文件，然后点击 **[智能推荐参数]** 按钮。插件会根据您音频的噪音水平和平均语速，自动为您设置一组合理的初始参数。

---

### 第三步：预览与验证

在您调整参数时，右侧的预览表格会实时更新，这是执行处理前最重要的验证步骤。

![预览与验证](images/splitter_preview.png)  
*(图3: 预览表格与匹配状态)*

-   **状态标签**: 表格上方的状态标签会清晰地告诉您**检测到的片段数**与**词表中的单词数**是否匹配。
    -   **✓ 匹配成功**: 绿色对勾表示一切正常，可以进行下一步处理。
    -   **✗ 不匹配**: 红色叉号表示存在问题。您需要返回第二步，继续调整分割参数，直到二者数量完全匹配。

-   **预览表格**:
    -   **试听**: **右键点击**任意一行，选择 **[试听此片段]**，或**选中行后按回车键**，可以立即听到该片段的分割效果，以判断分割点是否准确。
    -   **编辑**: **双击**“对应单词”列的单元格，可以直接修改该片段将被保存的文件名。
    -   **删除**: 如果预览中出现了不想要的片段（如录音前后的噪音），可以**右键点击**并选择 **[从预览中删除此片段]**。

---

### 第四步：输出与处理

当您对预览结果完全满意后，即可进行最后的处理。

1.  **设置输出文件夹**: 点击 **[浏览...]** 选择一个用于保存所有分割后音频文件的文件夹。
    > **智能路径**: 当您加载一个词表时，插件会自动为您生成一个推荐的输出路径 (`audio_tts/[词表名]/`)。
2.  **选择输出格式**: 在下拉菜单中选择 `WAV` (无损，推荐) 或 `MP3`。
3.  **开始处理**: 点击 **[开始处理]** 按钮。插件会开始批量分割和保存，您可以在下方的日志区和进度条中看到实时进度。

---

### 附录：常见问题 (FAQ)

-   **Q: 为什么片段数总是和单词数不匹配？**
    -   **A:** 最常见的原因是“静音阈值”或“最小静音时长”不适合您的录音。请尝试：
        1.  使用**智能推荐**功能获取初始值。
        2.  如果片段数**多于**单词数，说明分割过于灵敏。请尝试**增大**“最小静音时长”或**向左移动**“静音阈值”滑块。
        3.  如果片段数**少于**单词数，说明分割不够灵敏。请尝试**减小**“最小静音时长”或**向右移动**“静音阈值”滑块。

-   **Q: 切出来的单词总是缺了尾音怎么办？**
    -   **A:** 这是词尾弱辅音被当做静音切掉的典型情况。请切换到 **“完整模式”**，这种模式是专门为解决此问题设计的。

-   **Q: 我可以把词表复制成TTS容易识别的格式吗？**
    -   **A:** 当然可以。加载词表后，点击加载区的 **[复制为TTS格式]** 按钮，即可将所有单词以 `单词1, 单词2, 单词3, ...` 的格式复制到您的剪贴板。